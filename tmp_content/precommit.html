
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>Pre-commit hooks and code quality &#8212; Project Template  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/material.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="GitLab CI configuration" href="gitlab_ci.html" />
    <link rel="prev" title="Python code structure" href="python_structure.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=blue data-md-color-accent=light-blue>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#tmp_content/precommit" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="Project Template  documentation"
           class="md-header-nav__button md-logo">
          
            &nbsp;
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">Project Template  documentation</span>
          <span class="md-header-nav__topic"> Pre-commit hooks and code quality </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder=""Search""
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://gitlab.com/deepsense.ai/work/ds-template" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Project Template
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../"versions.json"",
        target_loc = "../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="../index.html" class="md-tabs__link">Project Template  documentation</a></li>
          <li class="md-tabs__item"><a href="../template_content.html" class="md-tabs__link"><strong>Template content</strong></a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="Project Template documentation" class="md-nav__button md-logo">
      
        <img src="../_static/" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="Project Template documentation">Project Template  documentation</a>
  </label>
    <div class="md-nav__source">
      <a href="https://gitlab.com/deepsense.ai/work/ds-template" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Project Template
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Contents:</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../quickstart.html" class="md-nav__link"><strong>Quickstart</strong></a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../template_content.html" class="md-nav__link"><strong>Template content</strong></a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="overview.html" class="md-nav__link">Overview of template generated project</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="python_structure.html" class="md-nav__link">Python code structure</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> Pre-commit hooks and code quality </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">Pre-commit hooks and code quality</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">"Contents"</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#tmp-content-precommit--page-root" class="md-nav__link">Pre-commit hooks and code quality</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#pre-commit-config-yaml" class="md-nav__link"><code class="docutils literal notranslate"><span class="pre">.pre-commit-config.yaml</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#docker-image" class="md-nav__link">Docker image</a>
        </li>
        <li class="md-nav__item"><a href="#mypy-additional-information" class="md-nav__link">mypy - additional information</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../_sources/tmp_content/precommit.md.txt">Show Source</a> </li>

  </ul>
</nav>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="#pre-commit-config-yaml" class="md-nav__link"><code class="docutils literal notranslate"><span class="pre">.pre-commit-config.yaml</span></code></a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="#docker-image" class="md-nav__link">Docker image</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="#mypy-additional-information" class="md-nav__link">mypy - additional information</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="gitlab_ci.html" class="md-nav__link">GitLab CI configuration</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="semver_package.html" class="md-nav__link">Packaging & semantic version</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../template_structure.html" class="md-nav__link"><strong>Cookiecutter template structure</strong></a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../overall_design.html" class="md-nav__link"><strong>Overall design</strong></a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">"Contents"</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#tmp-content-precommit--page-root" class="md-nav__link">Pre-commit hooks and code quality</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#pre-commit-config-yaml" class="md-nav__link"><code class="docutils literal notranslate"><span class="pre">.pre-commit-config.yaml</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#docker-image" class="md-nav__link">Docker image</a>
        </li>
        <li class="md-nav__item"><a href="#mypy-additional-information" class="md-nav__link">mypy - additional information</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../_sources/tmp_content/precommit.md.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="pre-commit-hooks-and-code-quality">
<span id="precommit"></span><h1 id="tmp-content-precommit--page-root">Pre-commit hooks and code quality<a class="headerlink" href="#tmp-content-precommit--page-root" title="Permalink to this heading">¶</a></h1>
<p>To ensure code consistency, good practices and remove any code smells we use pre-commit hook along with several linters and other tools.</p>
<p><strong>pre-commit</strong> is a tool which allows to quickly scan on commit/push code <strong>tracked by git</strong> in the repository, enforcing checks in minimum viable scope - only changed files.</p>
<p>Configuration is in <code class="docutils literal notranslate"><span class="pre">.pre-commit-config.yaml</span></code>, where you can find all tools installed in isolated environment and some of their configuration.
Most of the tools have detailed configuration in <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> file and some might have dedicated file.</p>
<p>All linters run with autofix to reduce manual labor. Developer can review / modify automatic fixes as he needs to re-add and commit affected files.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><code class="docutils literal notranslate"><span class="pre">pre-commit</span> <span class="pre">autoupdate</span></code> can be used to update all linters to the most recent version.</p>
<p><code class="docutils literal notranslate"><span class="pre">pre-commit</span> <span class="pre">run</span> <span class="pre">--all-files</span></code> runs for all tracked by git files. It usually runs on CI to ensure no files is overlooked.</p>
<p><code class="docutils literal notranslate"><span class="pre">pre-commit</span> <span class="pre">run</span> <span class="pre">pylint</span> <span class="pre">--all-files</span></code> runs selected tools only - useful for fixing issues.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>It is important to understand that pre-commit works in it’s own virtual environment - this might lead to different behavior of running the same
linter with or without pre-commit due to side effects of some installed locally packages!</p>
</div>
<section id="pre-commit-config-yaml">
<h2 id="pre-commit-config-yaml"><code class="docutils literal notranslate"><span class="pre">.pre-commit-config.yaml</span></code><a class="headerlink" href="#pre-commit-config-yaml" title="Permalink to this heading">¶</a></h2>
<p><strong>Use scroll on the text inside the below panel</strong>. It contains overview of some tools with an example configuration - it is not exactly the same as in the template.</p>
<div id="kodemo-content" style="width:100%;height:525px;display:block;top:0;left:0;padding:0;margin:0"></div>
<script src="../_static/precommit-tut.js"></script>
<script src="../_static/kodemo-player.umd.js"></script>
<script>
      const player = new KodemoPlayer(document.getElementById("kodemo-content"), {layout:"auto"});
      player.load(tutorial_content);
    </script><div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>There are some other great tools, like <a class="reference external" href="https://github.com/charliermarsh/ruff">ruff</a> - it is fast, but it has not full feature parity with
other linters it tries to replace. However, if your project allows it - please consider to use it instead of pylint, isort etc.</p>
</div>
</section>
<section id="docker-image">
<h2 id="docker-image">Docker image<a class="headerlink" href="#docker-image" title="Permalink to this heading">¶</a></h2>
<p>To reduce CI stage time we use image created with <code class="docutils literal notranslate"><span class="pre">docker/precommit/Dockerfile</span></code>.</p>
<p>If project is created with GitLab pipelines then automatically it should build &amp; use this image. If you are on different platform you need to configure it yourself.</p>
</section>
<section id="mypy-additional-information">
<h2 id="mypy-additional-information">mypy - additional information<a class="headerlink" href="#mypy-additional-information" title="Permalink to this heading">¶</a></h2>
<p><strong>mypy</strong> needs special care. Default settings only checks for project issues and works out of box with correctly typed projects.
More strict options are not turned on by default as many data science libraries are not high quality and in practice it leads to
frustration and minuscule gains in practice.</p>
<p>To discover or ignore what packages you use in a project that are untyped change mypy setting named <code class="docutils literal notranslate"><span class="pre">ignore_missing_imports=[true|false]</span></code>.
Some packages do not have typing information - and this settings raises error for ones which require type package.</p>
<p>To set a package-specific options you can do it this way:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="n">tool</span><span class="o">.</span><span class="n">mypy</span><span class="o">.</span><span class="n">overrides</span><span class="p">]]</span>
<span class="n">module</span> <span class="o">=</span> <span class="s2">"foo.*"</span>
<span class="o">...</span>
</pre></div>
</div>
<p>For libraries that require installation of type package you need to perform manual operation specific for each project - you need to modify <code class="docutils literal notranslate"><span class="pre">.pre-commit-config.yaml</span></code> file, here is an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span>   <span class="nb">id</span><span class="p">:</span> <span class="n">mypy</span>
        <span class="o">...</span>
        <span class="c1"># Required to have proper type annotations for external packages.</span>
        <span class="n">additional_dependencies</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">"fastapi~=0.83.0"</span><span class="p">,</span>
            <span class="s2">"numpy~=1.23.3"</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>It is highly recommended to do that, as it allows mypy to catch more errors. For code missing type information it always assumes <code class="docutils literal notranslate"><span class="pre">Any</span></code> type.</p>
<p>Sometimes a package do not have any type information nor additional package with it - in that case you can suppress mypy error by manually
marking an exact library to be ignored as mentioned before.</p>
<p>Please refer to <a class="reference external" href="https://mypy.readthedocs.io/en/stable/index.html">official mypy documentation</a> for more information.</p>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="python_structure.html" title="Python code structure"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> "Previous" </span> Python code structure </span>
              </div>
            </a>
          
          
            <a href="gitlab_ci.html" title="GitLab CI configuration"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> "Next" </span> GitLab CI configuration </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2023, deepsense.ai.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>